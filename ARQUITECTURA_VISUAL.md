# ğŸ—ï¸ Arquitectura Visual del Sistema Multi-Tenant

## ğŸ“Š Diagrama de Arquitectura Azure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          INTERNET / CLIENTES                             â”‚
â”‚                                                                           â”‚
â”‚   acme.accesslearn.com     techstart.accesslearn.com                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AZURE FRONT DOOR (CDN + WAF)                        â”‚
â”‚                                                                           â”‚
â”‚  â€¢ Global CDN                                                            â”‚
â”‚  â€¢ SSL/TLS Termination                                                   â”‚
â”‚  â€¢ DDoS Protection                                                       â”‚
â”‚  â€¢ Custom Domains                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                                  â”‚
            â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AZURE STATIC WEB APPS   â”‚      â”‚   AZURE FUNCTIONS        â”‚
â”‚  (Frontend - React)      â”‚      â”‚   (Backend - Node.js)    â”‚
â”‚                          â”‚      â”‚                          â”‚
â”‚  â€¢ React 19              â”‚      â”‚  â€¢ Serverless APIs       â”‚
â”‚  â€¢ TypeScript            â”‚      â”‚  â€¢ TypeScript            â”‚
â”‚  â€¢ Vite                  â”‚      â”‚  â€¢ HTTP Triggers         â”‚
â”‚  â€¢ Auto-deploy from Git  â”‚      â”‚  â€¢ Cosmos DB Bindings    â”‚
â”‚  â€¢ Custom 404            â”‚      â”‚  â€¢ JWT Auth              â”‚
â”‚                          â”‚      â”‚                          â”‚
â”‚  /dashboard              â”‚      â”‚  /api/users              â”‚
â”‚  /courses/:id            â”‚      â”‚  /api/courses            â”‚
â”‚  /admin                  â”‚      â”‚  /api/progress           â”‚
â”‚                          â”‚      â”‚  /api/auth               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                               â”‚
           â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚    â”‚
           â”‚    â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚    â”‚         â”‚  TENANT RESOLUTION MIDDLEWARE    â”‚
           â”‚    â”‚         â”‚  â€¢ Extract Tenant ID             â”‚
           â”‚    â”‚         â”‚  â€¢ Validate Tenant Exists        â”‚
           â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  â€¢ Inject Tenant Context         â”‚
           â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                         â”‚
           â”‚                         â–¼
           â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚    â”‚        AZURE KEY VAULT                     â”‚
           â”‚    â”‚  â€¢ Connection Strings                      â”‚
           â”‚    â”‚  â€¢ API Keys                                â”‚
           â”‚    â”‚  â€¢ JWT Secrets                             â”‚
           â”‚    â”‚  â€¢ Certificates                            â”‚
           â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AZURE COSMOS DB (NoSQL)                             â”‚
â”‚                         Serverless Mode                                  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   TENANT: acme-corp                               â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  Database: tenant-acme-corp                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Container: users         (Partition Key: /tenantId)         â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Container: courses       (Partition Key: /tenantId)         â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Container: progress      (Partition Key: /tenantId)         â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Container: achievements  (Partition Key: /tenantId)         â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Container: analytics     (Partition Key: /tenantId, TTL)    â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  Data: 45 users, 12 courses, ~60MB                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   TENANT: techstart-inc                           â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  Database: tenant-techstart-inc                                   â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Container: users                                             â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Container: courses                                           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Container: progress                                          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Container: achievements                                      â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Container: analytics                                         â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  Data: 120 users, 25 courses, ~150MB                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   SHARED: tenants (Metadata)                      â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  Database: shared-metadata                                        â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Container: tenants (All tenant configurations)              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                           â”‚
â”‚  Features:                                                               â”‚
â”‚  â€¢ 99.99% SLA                                                            â”‚
â”‚  â€¢ Automatic Backups (2 copies, 30 days retention)                      â”‚
â”‚  â€¢ Global Distribution Ready                                             â”‚
â”‚  â€¢ Partition-based Isolation                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AZURE BLOB STORAGE (Files)                             â”‚
â”‚                                                                           â”‚
â”‚  Container: tenant-acme-corp/                                            â”‚
â”‚  â”œâ”€â”€ logos/                                                              â”‚
â”‚  â”‚   â””â”€â”€ company-logo.png                                               â”‚
â”‚  â”œâ”€â”€ courses/                                                            â”‚
â”‚  â”‚   â”œâ”€â”€ course-123/                                                     â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ video-1.mp4                                                â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ video-1-captions.vtt                                        â”‚
â”‚  â”‚   â”‚   â””â”€â”€ thumbnail.jpg                                              â”‚
â”‚  â”œâ”€â”€ certificates/                                                       â”‚
â”‚  â”‚   â””â”€â”€ cert-abc-def.pdf                                               â”‚
â”‚  â””â”€â”€ user-uploads/                                                       â”‚
â”‚      â””â”€â”€ avatars/                                                        â”‚
â”‚                                                                           â”‚
â”‚  Container: tenant-techstart-inc/                                        â”‚
â”‚  â””â”€â”€ (similar structure)                                                 â”‚
â”‚                                                                           â”‚
â”‚  Features:                                                               â”‚
â”‚  â€¢ SAS Token Authentication                                              â”‚
â”‚  â€¢ CDN Integration                                                       â”‚
â”‚  â€¢ Lifecycle Management (auto-delete old files)                         â”‚
â”‚  â€¢ Encryption at Rest                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AZURE AD B2C (Authentication)                          â”‚
â”‚                                                                           â”‚
â”‚  Tenant: accesslearn.onmicrosoft.com                                     â”‚
â”‚                                                                           â”‚
â”‚  User Flows:                                                             â”‚
â”‚  â€¢ Sign Up & Sign In                                                     â”‚
â”‚  â€¢ Password Reset                                                        â”‚
â”‚  â€¢ Profile Editing                                                       â”‚
â”‚                                                                           â”‚
â”‚  Custom Policies:                                                        â”‚
â”‚  â€¢ SSO with Corporate AD                                                 â”‚
â”‚  â€¢ SAML Integration                                                      â”‚
â”‚  â€¢ MFA (Multi-Factor Auth)                                               â”‚
â”‚                                                                           â”‚
â”‚  Branding:                                                               â”‚
â”‚  â€¢ Custom per tenant (acme logo, techstart logo)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              MONITORING & OBSERVABILITY                                  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AZURE APPLICATION INSIGHTS                                       â”‚  â”‚
â”‚  â”‚  â€¢ Request Tracking                                               â”‚  â”‚
â”‚  â”‚  â€¢ Error Logging                                                  â”‚  â”‚
â”‚  â”‚  â€¢ Performance Metrics                                            â”‚  â”‚
â”‚  â”‚  â€¢ Custom Events                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AZURE MONITOR                                                    â”‚  â”‚
â”‚  â”‚  â€¢ Alerts (CPU > 80%, Errors > 50/min)                           â”‚  â”‚
â”‚  â”‚  â€¢ Dashboards                                                     â”‚  â”‚
â”‚  â”‚  â€¢ Log Analytics                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de Request Multi-Tenant

### **Ejemplo: Usuario de ACME Corp accede a sus cursos**

```
1. Browser Request
   â”œâ”€ URL: https://acme.accesslearn.com/courses
   â””â”€ Headers: Cookie (session)

2. Azure Front Door
   â”œâ”€ SSL Termination
   â”œâ”€ Cache Check (MISS)
   â””â”€ Route to Static Web App

3. Static Web App (Frontend)
   â”œâ”€ Load React App
   â”œâ”€ Detect subdomain: "acme"
   â”œâ”€ Set TenantContext: tenantId = "acme"
   â””â”€ Call API: GET /api/courses

4. Azure Functions (Backend)
   â”œâ”€ Receive Request
   â”œâ”€ Tenant Resolution Middleware
   â”‚  â”œâ”€ Extract: x-tenant-id = "acme"
   â”‚  â”œâ”€ Validate: Tenant exists
   â”‚  â””â”€ Get Database: tenant-acme-corp
   â”œâ”€ Auth Middleware
   â”‚  â”œâ”€ Validate JWT token
   â”‚  â”œâ”€ Extract userId from token
   â”‚  â””â”€ Check user belongs to "acme" tenant
   â”œâ”€ Business Logic
   â”‚  â”œâ”€ CourseRepository.list(tenantId: "acme")
   â”‚  â””â”€ Filter by user permissions

5. Cosmos DB
   â”œâ”€ Database: tenant-acme-corp
   â”œâ”€ Container: courses
   â”œâ”€ Query: SELECT * FROM c WHERE c.tenantId = "acme"
   â””â”€ Return: [...courses]

6. Response Flow
   â”œâ”€ Backend: Format response
   â”œâ”€ Frontend: Render courses
   â””â”€ Browser: Display UI

Total Time: ~150-300ms
```

---

## ğŸ” Data Isolation Strategy

### **Multi-Layer Security:**

```
Layer 1: Network Level
â”œâ”€ Azure Front Door WAF
â”œâ”€ DDoS Protection
â””â”€ IP Filtering (optional)

Layer 2: Application Level
â”œâ”€ Tenant Resolution Middleware (CRITICAL)
â”œâ”€ JWT Token Validation
â””â”€ User-Tenant Binding Check

Layer 3: Database Level
â”œâ”€ Separate Databases per Tenant
â”œâ”€ Partition Keys on tenantId
â””â”€ Read/Write validation

Layer 4: Storage Level
â”œâ”€ Separate Blob Containers per Tenant
â”œâ”€ SAS Tokens scoped to container
â””â”€ RBAC permissions

Layer 5: Audit Level
â”œâ”€ All queries logged with tenantId
â”œâ”€ Data access monitoring
â””â”€ Anomaly detection
```

---

## ğŸ“Š Flujo de Datos: Nuevo Tenant

```
1. Tenant Registration (Super Admin)
   â”œâ”€ Submit: companyName, subdomain, adminEmail
   â””â”€ Validate: subdomain available

2. Backend: Create Tenant
   â”œâ”€ Generate tenantId (UUID)
   â”œâ”€ Create Cosmos DB database: tenant-{id}
   â”œâ”€ Create containers (users, courses, etc)
   â”œâ”€ Create Blob container: tenant-{id}
   â”œâ”€ Save tenant metadata
   â””â”€ Return: tenantId

3. Backend: Create Admin User
   â”œâ”€ Register user in Azure AD B2C
   â”œâ”€ Create user record in Cosmos DB
   â”œâ”€ Set role: admin
   â””â”€ Send welcome email

4. Backend: Setup Defaults
   â”œâ”€ Create default branding
   â”œâ”€ Create sample course (optional)
   â””â”€ Setup default settings

5. Frontend: Welcome Flow
   â”œâ”€ Redirect to: https://{subdomain}.accesslearn.com
   â”œâ”€ Admin first login
   â”œâ”€ Onboarding wizard
   â””â”€ Ready to use!

Total Time: ~30 seconds
```

---

## ğŸ’° Cost Breakdown (Monthly, 100 usuarios por tenant)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SERVICIO                      â”‚  COSTO/TENANT â”‚  10 TENANTS â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Cosmos DB Serverless          â”‚  $0.20        â”‚  $2.00      â”‚
â”‚  Azure Functions (Consumption) â”‚  $0.50        â”‚  $5.00      â”‚
â”‚  Static Web Apps               â”‚  $0.00        â”‚  $0.00      â”‚
â”‚  Blob Storage                  â”‚  $0.10        â”‚  $1.00      â”‚
â”‚  Azure AD B2C                  â”‚  $0.05        â”‚  $0.50      â”‚
â”‚  Front Door                    â”‚  $0.15        â”‚  $1.50      â”‚
â”‚  Application Insights          â”‚  $0.10        â”‚  $1.00      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TOTAL                         â”‚  $1.10/tenant â”‚  $11.00/mes â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Notas:
â€¢ Primeros $25 de Cosmos DB gratis (primeros 25GB + 1000 RU/s)
â€¢ Primeros 5GB de Functions gratis
â€¢ Static Web Apps FREE tier (sin custom domain)
â€¢ Blob Storage: $0.02/GB

Con 10 tenants, probablemente pagarÃ¡s ~$0-20/mes
Con 50 tenants, probablemente pagarÃ¡s ~$100-200/mes
Con 100 tenants, probablemente pagarÃ¡s ~$300-500/mes
```

---

## ğŸ”„ CI/CD Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GITHUB ACTIONS WORKFLOW                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Trigger: Push to main branch

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Code Checkout   â”‚
â”‚  - git clone        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Install Deps    â”‚
â”‚  - npm install      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3a. Lint        â”‚  â”‚  3b. Type Check  â”‚  â”‚  3c. Tests       â”‚
â”‚  - eslint        â”‚  â”‚  - tsc --noEmit  â”‚  â”‚  - vitest        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚                     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  4. Build        â”‚
                    â”‚  - Frontend      â”‚
                    â”‚  - Backend       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  5a. Deploy Frontendâ”‚   â”‚  5b. Deploy Backend â”‚
    â”‚  - Static Web Apps  â”‚   â”‚  - Azure Functions  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  6. Run E2E Tests    â”‚
                â”‚  - Playwright        â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  7. Notify           â”‚
                â”‚  - Slack/Email       â”‚
                â”‚  - Status: Success   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total Time: 5-8 minutes
```

---

## ğŸ¯ Arquitectura de Seguridad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SECURITY LAYERS                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. PERIMETER SECURITY
   â”œâ”€ Azure Front Door WAF
   â”‚  â”œâ”€ OWASP Top 10 Protection
   â”‚  â”œâ”€ Bot Protection
   â”‚  â””â”€ Rate Limiting
   â”œâ”€ DDoS Protection
   â””â”€ Geo-Filtering

2. APPLICATION SECURITY
   â”œâ”€ HTTPS Only (TLS 1.3)
   â”œâ”€ CORS Policy (strict origins)
   â”œâ”€ CSP Headers
   â”œâ”€ XSS Protection
   â”œâ”€ CSRF Tokens
   â””â”€ Input Validation (Zod)

3. AUTHENTICATION & AUTHORIZATION
   â”œâ”€ Azure AD B2C
   â”‚  â”œâ”€ JWT Tokens (RS256)
   â”‚  â”œâ”€ Token Expiry: 1 hour
   â”‚  â”œâ”€ Refresh Tokens: 7 days
   â”‚  â””â”€ MFA (optional)
   â”œâ”€ Role-Based Access Control
   â”‚  â”œâ”€ Super Admin
   â”‚  â”œâ”€ Tenant Admin
   â”‚  â””â”€ Employee
   â””â”€ Tenant Isolation Check

4. DATA SECURITY
   â”œâ”€ Encryption at Rest (Cosmos DB)
   â”œâ”€ Encryption in Transit (TLS)
   â”œâ”€ Secrets in Key Vault
   â”œâ”€ No credentials in code
   â””â”€ Audit Logs (all operations)

5. COMPLIANCE
   â”œâ”€ GDPR Ready
   â”‚  â”œâ”€ Right to Access
   â”‚  â”œâ”€ Right to Delete
   â”‚  â””â”€ Data Portability
   â”œâ”€ SOC 2 (Azure certified)
   â””â”€ Data Residency Options
```

---

## ğŸ“ Escalabilidad

### **Horizontal Scaling:**

```
Current: 10 tenants
â”œâ”€ Cosmos DB: Serverless (auto-scales)
â”œâ”€ Functions: Auto-scale (0 to infinity)
â”œâ”€ Static Web App: CDN (global)
â””â”€ Cost: ~$20/mes

Scale to: 100 tenants
â”œâ”€ Cosmos DB: Still Serverless (or switch to Provisioned)
â”œâ”€ Functions: Auto-scale (more instances)
â”œâ”€ Static Web App: Same (CDN)
â””â”€ Cost: ~$300-500/mes

Scale to: 1,000 tenants
â”œâ”€ Cosmos DB: Provisioned Throughput + Autoscale
â”œâ”€ Functions: Premium Plan (dedicated instances)
â”œâ”€ Static Web App: Same
â””â”€ Cost: ~$2,000-3,000/mes

Scale to: 10,000 tenants
â”œâ”€ Cosmos DB: Multiple accounts (sharding)
â”œâ”€ Functions: Premium Plan + App Service Environment
â”œâ”€ Consider: Kubernetes (AKS)
â””â”€ Cost: ~$20,000-30,000/mes
```

---

## ğŸ” Monitoring Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  AZURE MONITOR DASHBOARD                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SYSTEM HEALTH                                           â”‚  â”‚
â”‚  â”‚  â€¢ Uptime: 99.98%                                        â”‚  â”‚
â”‚  â”‚  â€¢ Response Time: 145ms avg                              â”‚  â”‚
â”‚  â”‚  â€¢ Error Rate: 0.02%                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  TENANTS                                                 â”‚  â”‚
â”‚  â”‚  â€¢ Total: 10                                             â”‚  â”‚
â”‚  â”‚  â€¢ Active Users (24h): 450                               â”‚  â”‚
â”‚  â”‚  â€¢ Total Requests (24h): 125,000                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  COSMOS DB                                               â”‚  â”‚
â”‚  â”‚  â€¢ Total RU/s: 8,500                                     â”‚  â”‚
â”‚  â”‚  â€¢ Storage: 4.2 GB                                       â”‚  â”‚
â”‚  â”‚  â€¢ Avg Latency: 8ms                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  COSTS (MTD)                                             â”‚  â”‚
â”‚  â”‚  â€¢ Cosmos DB: $12.50                                     â”‚  â”‚
â”‚  â”‚  â€¢ Functions: $8.20                                      â”‚  â”‚
â”‚  â”‚  â€¢ Storage: $2.10                                        â”‚  â”‚
â”‚  â”‚  â€¢ Total: $22.80                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

Esta arquitectura estÃ¡ diseÃ±ada para:

âœ… **Escalabilidad:** De 10 a 10,000 tenants  
âœ… **Seguridad:** Multi-layer security  
âœ… **Costo-Eficiencia:** Pay-as-you-grow  
âœ… **Performance:** < 200ms response time  
âœ… **Disponibilidad:** 99.99% SLA  
âœ… **Global:** Ready for multi-region  

ğŸš€ **Listo para producciÃ³n y crecer con tu negocio!**
